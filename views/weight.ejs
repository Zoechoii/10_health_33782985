<%- include('partials/header', { title: 'Weight Management - YakTime', username: username }) %>

<div class="page-container">
    <h1>Weight Management</h1>
    
    <% if (error) { %>
    <div class="alert alert-error"><%= error %></div>
    <% } %>
    
    <% if (typeof success !== 'undefined' && success) { %>
    <div class="alert alert-success">
        <% if (success === 'added') { %>Weight recorded.<% } %>
        <% if (success === 'deleted') { %>Weight record deleted.<% } %>
        <% if (success === 'goal_set') { %>Goal set.<% } %>
    </div>
    <% } %>
    
    <div class="content-grid">
        <!-- Add Record -->
        <div class="content-card">
            <h2>Record Weight</h2>
            <form action="/weight/add" method="POST" class="form">
                <div class="form-group">
                    <label for="weight">Weight (kg)</label>
                    <input type="number" id="weight" name="weight" step="0.1" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="record_date">Date</label>
                    <input type="date" id="record_date" name="record_date" value="<%= new Date().toISOString().split('T')[0] %>" required>
                </div>
                
                <button type="submit" class="btn btn-primary">Record</button>
            </form>
        </div>
        
        <!-- Goal -->
        <div class="content-card">
            <h2>Set Goal</h2>
            <form action="/weight/goal" method="POST" class="form">
                <div class="form-group">
                    <label for="target_weight">Target Weight (kg)</label>
                    <input type="number" id="target_weight" name="target_weight" step="0.1" min="0" 
                           value="<%= goal ? goal.target_weight : '' %>" required>
                </div>
                
                <div class="form-group">
                    <label for="target_date">Target Date (Optional)</label>
                    <input type="date" id="target_date" name="target_date" 
                           value="<%= goal && goal.target_date ? new Date(goal.target_date).toISOString().split('T')[0] : '' %>">
                </div>
                
                <button type="submit" class="btn btn-primary">Set Goal</button>
            </form>
        </div>
    </div>
    
    <!-- Records -->
    <div class="content-card full-width">
        <h2>Weight Record History</h2>
        <% if (weightRecords && weightRecords.length > 0) { %>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Weight (kg)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% weightRecords.forEach(record => { %>
                    <tr>
                        <td><%= new Date(record.record_date).toLocaleDateString('en-US') %></td>
                        <td><strong><%= record.weight %>kg</strong></td>
                        <td>
                            <form action="/weight/delete/<%= record.id %>" method="POST" style="display: inline;">
                                <button type="submit" class="btn btn-danger btn-sm" 
                                        onclick="return confirm('Are you sure you want to delete?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
        <% } else { %>
        <p class="empty-state">No weight records yet.</p>
        <% } %>
    </div>
</div>

<%- include('partials/footer') %>

